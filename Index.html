<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
             <script src="NetworkTablesObject.js"></script>
        <!-- This starts the NetworkTables websocket, it can be accessed from multiple
         pages simultaneously -->
             <script src="/networktables/networktables.js"></script>

         <!-- Obviously, you will want to copy this file locally in a real 
              dashboard, as the Driver Station won't have internet access -->
             <script src="jQuery.js"></script>
             <script src="d3.js"></script>
     
         <!-- uncomment this is you want to use included utility functions that
              implement common functionality that you might find useful. Requires
              that d3.js and jQuery are included first -->
             <script src="/networktables/utils.js"></script>
    </head>
    <body>
        <div>
	        NetworkTables websocket: <span id="connectstate">Unknown state</span><br/>
	        Robot: <span id="robotstate">Unknown state</span> @ <span id="robotAddress">disconnected</span>
        </div>

        <a href="./Debug.html">Debugger</a>

        <hr/>

        Autonomous Position: <select id="autonomousPos"></select>
        Autonomous Type: <select id="autonomousType"></select>
        <br>

        <span>P: </span><input id="changeP" type="text">
        <span> I: </span><input id="changeI" type="text">
        <span> D: </span><input id="changeD" type="text">
        <span> K: </span><input id="changeK" type="text">
        <span> IZ: </span><input id="changeIZ" type="text">
        <span> PO: </span><input id="changePO" type="text">
        <span> CLE: </span><input id="changeCLE" type="text">
        <br><br>
        
        <div id="dataGoesHere"></div>

        <script type="text/javascript">
            "use strict";

            $(document).ready(function(){
	            // sets a function that will be called when the websocket connects/disconnects
	            NetworkTables.addWsConnectionListener(onNetworkTablesConnection, true);
	
	            // sets a function that will be called when the robot connects/disconnects
	            NetworkTables.addRobotConnectionListener(onRobotConnection, true);

                // attaches the select element to a SendableChooser object
                attachSelectToSendableChooser("#autonomousPos", "Position");
                attachSelectToSendableChooser("#autonomousType", "Match Type");
	
	            // sets a function that will be called when any NetworkTables key/value changes
	            NetworkTables.addGlobalListener(onValueChanged, true);
            });
            function onRobotConnection(connected) {
	            $('#robotstate').text(connected ? "Connected!" : "Disconnected");
	            $('#robotAddress').text(connected ? NetworkTables.getRobotAddress() : "disconnected");
            }
            function onNetworkTablesConnection(connected) {
	            if (connected) {
		            $("#connectstate").text("Connected!");
		
		            // clear the table
		            $("#nt tbody > tr").remove();
		
	            } else {
		            $("#connectstate").text("Disconnected!");
	            }
            }

            document.getElementById("changeP").addEventListener("change", function(event) {
                NetworkTables.putValue("/1073Table/changeP", parseFloat(event.target.value));
            });
            document.getElementById("changeI").addEventListener("change", function(event) {
                NetworkTables.putValue("/1073Table/changeI", parseFloat(event.target.value));
            });
            document.getElementById("changeD").addEventListener("change", function(event) {
                NetworkTables.putValue("/1073Table/changeD", parseFloat(event.target.value));
            });
            document.getElementById("changeK").addEventListener("change", function(event) {
                NetworkTables.putValue("/1073Table/changeK", parseFloat(event.target.value));
            });
            document.getElementById("changeIZ").addEventListener("change", function(event) {
                NetworkTables.putValue("/1073Table/changeIZ", parseFloat(event.target.value));
            });
            document.getElementById("changePO").addEventListener("change", function(event) {
                NetworkTables.putValue("/1073Table/changePO", parseFloat(event.target.value));
            });
            document.getElementById("changeCLE").addEventListener("change", function(event) {
                NetworkTables.putValue("/1073Table/changeCLE", parseFloat(event.target.value));
            });

            var objs = [];
            
            objs[0] = new NetworkTablesObject("/1073Table/PIDReadout");
            objs[1] = new NetworkTablesObject("/1073Table/GearBoxReadout", "null");
            objs[2] = new NetworkTablesObject("/1073Table/VisionReadout", "null");
            objs[3] = new NetworkTablesObject("/1073Table/LidarReadout", "null");
            objs[4] = new NetworkTablesObject("/1073Table/Gyro");
            
            function onValueChanged(key, value, isNew) {
                // key thing here: we're using the various NetworkTable keys as
            	// the id of the elements that we're appending, for simplicity. However,
            	// the key names aren't always valid HTML identifiers, so we use
                // the NetworkTables.keyToId() function to convert them appropriately
                for (var i = 0; i < objs.length; i++){
                    objs[i].refresh();
                }
            	/*if (isNew) {
                    objs[key] = new NetworkTablesObject(key, value);
            	} else {
            		// similarly, use keySelector to convert the key to a valid jQuery
                    // selector. This should work for class names also, not just for ids
                    objs[key].refresh();
            	}*/
            }
        </script>
    </body>
</html>